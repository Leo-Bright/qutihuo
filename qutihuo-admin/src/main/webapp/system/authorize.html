<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Dashboard</title>

    <meta name="description" content="Dashboard" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" href="/assets/img/favicon.png" type="image/x-icon">

    <!--Basic Styles-->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet" />
    <link href="/assets/css/weather-icons.min.css" rel="stylesheet" />

    <!--Beyond styles-->
    <link id="beyond-link" href="/assets/css/beyond.min.css" rel="stylesheet" type="text/css" />
    <link href="/assets/css/typicons.min.css" rel="stylesheet" />
    <link href="/assets/css/animate.min.css" rel="stylesheet" />

    <!--Skin Script: Place this script in head to load scripts for skins and rtl support-->
    <script src="/assets/js/skins.js"></script>
   <style>
		.category-title {
			padding:6px 15px; 
			border-radius:999em; 
			background:#428bca; 
			color:#fff;
		}

		.menu-item {
			margin-bottom:10px;
		}

		.menu-title {
			padding:6px 15px; 
			background:#5bc0de; 
			color:#fff;
			height:32px; 
			line-height:1.2;
			font-size:12px;
			min-width:50px; 
			margin: 0 8px 10px 0;
		}

		.operation-item {
			float: left; 
			height:32px; 
			margin:0 15px 10px 0; 
			padding:6px 15px; 
			background:#eaeaea; 
			color:#555; 
			line-height:1.2;
		}
   </style>
</head>

<body>
    <!-- Navbar -->
    <#include "/common/navbar.html">
    <!-- /Navbar -->
    
    <!-- Main Container -->
    <div class="main-container container-fluid">
        <!-- Page Container -->
        <div class="page-container">
            <!-- Page Sidebar -->
            <#include "/common/menu.html">
            <!-- /Page Sidebar -->
            
            <!-- Page Content -->
            <div class="page-content">
            
                <!-- Page Breadcrumb -->
                <div class="page-breadcrumbs">
                    <ul class="breadcrumb">
                        <li>
                            <i class="fa fa-home"></i> 
                            <a href="#">用户管理</a>
                        </li>
                        <li><a href="/system/roleList.jhtml">角色列表</a></li>
                        <li>角色授权</li>
                    </ul>
                </div>
                <!-- /Page Breadcrumb -->
                
                <div class="page-body">
                    <div class="row">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                        <div class="col-xs-12 col-md-12">
                            <div class="well with-header with-footer">
                                <div class="header">
                                	<i class="glyphicon glyphicon-edit"></i>&nbsp;<b>角色授权</b>
                                </div>
                            
								<form method="post" class="form-horizontal" method="POST" action="/system/saveAuthorize.jhtml">
									<input type="hidden" name="roleId" value="${roleId}"/>
									
									<#list rootSystemActionList as item >
									<div class="form-group">
										<label class="col-lg-2 control-label "><span class="category-title">${item.actionName}</span></label>
										<div class="menu-list col-lg-10">
											<#if item.actionType==2>
												<div class="menu-item clearfix">
													<h6>
														<label class="menu-title">
															<input type="checkbox" name="actionIds" value="${item.id}">
	                                                        <span class="text">${item.actionName}</span>
	                                                    </label>
	                                                </h6>
													<div class="operation-list" >
														<#list parentSystemActionMap[item.id?string]?if_exists as operation>
															<div class="operation-item">
		                                                        <label>
		                                                            <input type="checkbox" name="actionIds" value="${operation.id}">
		                                                            <span class="text">${operation.actionName}</span>
		                                                        </label>
			                                                </div>
								                       	</#list>
													</div>
												</div>
							                 <#else>
							                     <#list parentSystemActionMap[item.id?string] as menuNode >
													<div class="menu-item clearfix">
														<h6>
															<label class="menu-title">
																<input type="checkbox" name="actionIds" value="${menuNode.id}">
		                                                        <span class="text">${menuNode.actionName}</span>
		                                                    </label>
		                                                </h6>
														<div class="operation-list">
															<#list parentSystemActionMap[menuNode.id?string]?if_exists as operation>
																<div class="operation-item">
			                                                        <label>
			                                                            <input type="checkbox" name="actionIds" value="${operation.id}">
			                                                            <span class="text">${operation.actionName}</span>
			                                                        </label>
				                                                </div>
									                         </#list>
														</div>
													</div>
												</#list>
							                 </#if>
										</div>
									</div>
									</#list>

									<div class="form-group">
                                        <div class="col-lg-2 col-lg-offset-2">
                                        	 <button type="submit" class="btn btn-success">确认</button>
                                        </div>
                                    </div>
                                    
                                </form>
                            </div>
        
                        </div>
                    </div>
                </div>
            </div>
            <!-- /Page Content -->
        </div>
        <!-- /Page Container -->
        <!-- Main Container -->
    </div>

    <!--Basic Scripts-->
    <script src="/assets/js/jquery-2.0.3.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>

    <!--Beyond Scripts-->
    <script src="/assets/js/beyond.min.js"></script>
    <script src="/assets/js/validation/formValidation.min.js"></script>
    <script src="/assets/js/validation/framework/bootstrap.min.js"></script>
    <script src="/assets/js/fuelux/spinner/fuelux.spinner.min.js"></script>
	<script src="/assets/js/toastr/toastr.js"></script>
	<script src="/assets/js/jquery.formautofill.min.js"></script>
<script>
	
	$(document).ready(function() {
	
		// 自动填充表单
		var actionIds=[<#list legalPrivilageList as item>${item.actionId}<#if item_has_next>,</#if></#list>];
		$.each(actionIds,function(n,value) {   
			$('.form-horizontal').find('input[name="actionIds"][value="'+ value +'"]').prop("checked",true);
  		});  
		
		// 单击菜单节点时，自动操作子节点
		$('.menu-title').find('input[name="actionIds"]').on('click', function() {
			var subActionIdCheckBox=$(this).parents(".menu-item").find('.operation-item input[name="actionIds"]');
			if($(this).prop("checked")){
				subActionIdCheckBox.prop("checked",true);
			}else{
				subActionIdCheckBox.removeAttr("checked");
			}
		});
		
		// 选中子节点时，自动选中菜单节点
		$('.operation-item').find('input[name="actionIds"]').on('click', function() {
			if($(this).prop("checked")){
				$(this).parents(".menu-item").find('.menu-title input[name="actionIds"]').prop("checked",true);
			}
		});
		
		// 异步提交表单
		$('.form-horizontal').formValidation().on('success.form.fv', function(e) {
	        // Prevent form submission
	        e.preventDefault();
	
	        // Get the form instance
	        var $form = $(e.target);
	
	        // Get the FormValidation instance
	        var bv = $form.data('formValidation');
	
	        // Use Ajax to submit form data
	        $.post($form.attr('action'), $form.serialize(), function(result) {
	            if(result.state.code==200){
	        		Notify('操作成功', 'bottom-right', '500', 'success', 'fa-check', true);
	        		setTimeout(function () {window.location = "/system/roleList.jhtml";}, 800);
	        	}else{
	        		Notify('操作失败!', 'bottom-right', '1500', 'danger', 'fa-bolt', true); 
	        	}
	        }, 'json');
	    });
	
	});
	
</script>
</body>
</html>
