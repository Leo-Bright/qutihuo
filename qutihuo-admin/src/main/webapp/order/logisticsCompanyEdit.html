<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Dashboard</title>

    <meta name="description" content="Dashboard" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="/assets/js/Lodop.js"></script>
      <#include "/common/header.html">
   
</head>

<body>
    <!-- Navbar -->
    <#include "/common/navbar.html">
    <!-- /Navbar -->
    
    <!-- Main Container -->
    <div class="main-container container-fluid">
        <!-- Page Container -->
        <div class="page-container">
            <!-- Page Sidebar -->
            <#include "/common/menu.html">
            <!-- /Page Sidebar -->
            
            <!-- Page Content -->
            <div class="page-content">
            
                <!-- Page Breadcrumb -->
                <div class="page-breadcrumbs">
                    <ul class="breadcrumb">
                        <li>
                            <i class="fa fa-home"></i> 
                            <a href="#">订单管理</a>
                        </li>
                        <li><a href="/logisticsCompany/logisticsCompanyList.jhtml">快递公司列表</a></li>
                        <li>新增快递公司</li>
                    </ul>
                </div>
                <!-- /Page Breadcrumb -->
                
                <div class="page-body">
                    <div class="row">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                        <div class="col-xs-12 col-md-12">
                            <div class="well with-header with-footer">
                                <div class="header">
                                	<i class="glyphicon glyphicon-edit"></i>&nbsp;<b>新增快递公司</b>
                                </div>
                            
								<form id="html5Form" method="post" class="form-horizontal" method="POST" action="/logisticsCompany/saveLogisticsCompany.jhtml">
									<input type="hidden" name="id"/>
                                    <div class="form-group">
                                        <label class="col-lg-2 control-label">快递公司名称<font color="red"> *</font></label>
                                        <div class="col-lg-4">
                                            <input type="text" class="form-control" name="lcName"/>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-lg-2 control-label">快递公司编码<font color="red"> *</font></label>
                                        <div class="col-lg-4">
                                            <input type="text" class="form-control" name="lcCode"/>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="col-lg-2 control-label">联系人</label>
                                        <div class="col-lg-4">
                                            <input type="text" class="form-control" name="contact"/>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="col-lg-2 control-label">联系电话</label>
                                        <div class="col-lg-4">
                                            <input type="text" class="form-control" name="telephone"/>
                                        </div>
                                    </div>
                                    
                                    
                                    <div class="form-group">
                                        <label class="col-lg-2 control-label">快递模板</label>
                                        <div class="col-lg-6">
                                            <textarea class="form-control" id="expressTemplate" name="expressTemplate" rows="5" readonly="true">
                                            ${(logisticsCompany.expressTemplate)!''} 
                                            </textarea>
                                        </div>
                                        <button type="button" id="setExpressTemplate" class="btn btn-default">设置快递模板</button>
                                    </div>
                                    
                                    <div class="form-group">
                                        <div class="col-lg-2 col-lg-offset-2">
                                        	 <button type="submit" class="btn btn-success">确认</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
        
                        </div>
                    </div>
                </div>
            </div>
            <!-- /Page Content -->
        </div>
        <!-- /Page Container -->
        <!-- Main Container -->
    </div>

    <!--Basic Scripts-->

<script>
	$(document).ready(function() {
		$('#html5Form').formValidation({
			fields: {
				lcName: {
	                validators: {
	                    notEmpty: {
	                        message: '物流公司名称不能为空'
	                    }
	                }
	            },
	            lcCode: {
	                validators: {
	                    notEmpty: {
	                        message: '物流公司编码不能为空'
	                    }
	                }
	            }
	        }
		})        
		.on('success.form.fv', function(e) {
            // Prevent form submission
            e.preventDefault();

            // Get the form instance
            var $form = $(e.target);

            // Get the FormValidation instance
            var bv = $form.data('formValidation');

            // Use Ajax to submit form data
            $.post($form.attr('action'), $form.serialize(), function(result) {
           // console.log(result);
                if(result.state.code==200){
	        		Notify('操作成功', 'bottom-right', '1500', 'success', 'fa-check', true);
	        		setTimeout(function () {window.location = "/logisticsCompany/logisticsCompanyList.jhtml";}, 1500);
	        	}else{
	        		Notify('操作失败!', 'bottom-right', '1500', 'danger', 'fa-bolt', true); 
	        	}
            }, 'json');
        });
		
		
        
		// 构建表单数据	
		var formData = {			
         	"id":${(logisticsCompany.id)!'null'},
			"lcName":"${(logisticsCompany.lcName)!''}",
			"lcCode":"${(logisticsCompany.lcCode)!''}",
			"contact":"${(logisticsCompany.contact)!''}",
			"telephone":"${(logisticsCompany.telephone)!''}"
        };
        
		// 自动填充表单
        $("#html5Form").autofill(formData);
		$('.spinner').spinner({max:9999999,min:100,value:formData.weight});

	});

	
	 $('#setExpressTemplate').on('click', function () {
		 var expressTemplate = $("#expressTemplate").val();
			LODOP=getLodop();
			//var checkeds = $("input[type=checkbox]:checked");	
			if(!contains(expressTemplate,"LODOP",false)){ //首次设置
				LODOP.PRINT_INIT("快递单打印");
				LODOP.SET_PRINT_MODE("PROGRAM_CONTENT_BYVAR",true);//生成程序时，内容参数有变量用变量，无变量用具体值
				LODOP.ADD_PRINT_TEXT(1*30,100,180,30,"收货人");
				LODOP.ADD_PRINT_TEXT(2*30,100,180,30,"地址");
				LODOP.ADD_PRINT_TEXT(3*30,100,180,30,"联系电话");
				LODOP.ADD_PRINT_TEXT(4*30,100,180,30,"邮政编码");
				LODOP.ADD_PRINT_TEXT(5*30,100,180,30,"发货人");
				LODOP.ADD_PRINT_TEXT(6*30,100,180,30,"发货地址");
				LODOP.ADD_PRINT_TEXT(7*30,100,180,30,"发货人电话");
				//LODOP.ADD_PRINT_SETUP_BKIMG("<img border='0' src='"+templateImages+"'>");
				LODOP.SET_PRINT_MODE("PRINT_SETUP_PROGRAM",true);
				$("#expressTemplate").val(LODOP.PRINT_SETUP());
			}else{
				var tbodys = expressTemplate.split(";");
				for(var i=0,length=tbodys.length;i<length;i++){
					if(contains(tbodys[i],"ADD_PRINT_SETUP_BKIMG",false)){
						tbodys[i]="";
					}
				}
				eval(tbodys.join(";"));
				LODOP.SET_PRINT_MODE("PRINT_SETUP_PROGRAM",true);
				//LODOP.ADD_PRINT_SETUP_BKIMG("<img border='0' src='"+templateImages+"'>");
				$("#expressTemplate").val(LODOP.PRINT_SETUP());
			}
	    });
	
</script>
</body>
</html>
